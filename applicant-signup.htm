<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Company Driver Registration | Werner Driver Application</title>
    <link rel="stylesheet" href="/css/layout.css" />
    <style>
        .signup-page { max-width: 1080px; margin: 0 auto; padding: 48px 24px 96px; }
        .signup-header { text-align: center; margin-bottom: 32px; }
        .signup-header h1 { margin: 0 0 8px; color: #0b63ce; }
        .notice { background: #f0f6ff; border: 1px solid #c8ddff; color: #0f3e8a; padding: 16px; border-radius: 8px; margin-bottom: 24px; }
        .assessment-notice { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 16px; border-radius: 8px; margin-bottom: 24px; }
        form.signup-form { background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 32px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); }
        fieldset { border: 1px solid #e5e7eb; padding: 20px; margin: 0 0 24px; border-radius: 8px; background: #fafafa; }
        legend { font-weight: 700; margin-bottom: 16px; display: block; color: #0b63ce; font-size: 18px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
        label { font-weight: 600; display: block; margin-bottom: 6px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; box-sizing: border-box; }
        textarea { min-height: 100px; resize: vertical; }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 16px; margin-top: 8px; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; }
        .checkbox-item input[type="checkbox"], .checkbox-item input[type="radio"] { width: auto; margin: 0; }
        .actions { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 24px; justify-content: center; }
        .btn-primary { background: #0b63ce; color: #fff; border: none; padding: 16px 32px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 16px; }
        .btn-primary:hover { background: #0952a5; }
        .btn-secondary { background: #f3f4f6; color: #111; border: 1px solid #d1d5db; padding: 16px 32px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .helper { font-size: 12px; color: #666; margin-top: 4px; }
        .required { color: #dc2626; }
        .success { display: none; margin-top: 16px; padding: 16px; background: #e8f7ed; border: 1px solid #b7e4c7; color: #155724; border-radius: 8px; text-align: center; }
        .error { display: none; margin-top: 16px; padding: 16px; background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; border-radius: 8px; }
        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="page">
    <main class="signup-page">
        <div class="signup-header">
            <h1>Company Driver Registration Form</h1>
            <p>Complete this comprehensive application to join Werner as a company driver.</p>
            <div style="margin-top: 12px; padding: 10px; background: #f0f6ff; border-radius: 6px; border: 1px solid #c8ddff;">
                <p style="margin: 0; color: #0f3e8a; font-weight: 600; font-size: 13px;">ðŸ“§ Questions? <a href="mailto:wernerenterprisesrecuritment@gmail.com" style="color: #0b63ce;">Contact Us</a></p>
            </div>
        </div>

        <div class="assessment-notice">
            <strong>ðŸ“§ Important:</strong> After submitting your application, please wait for our assessment team to review your information. 
            You will receive a response via email within 24-72 hours with next steps or additional requirements.
        </div>

        <form class="signup-form" id="applicantForm" novalidate>
            <!-- Personal Information -->
            <fieldset>
                <legend>1. Personal Information</legend>
                <div class="grid">
                    <div>
                        <label for="firstName">Full Name (First) <span class="required">*</span></label>
                        <input id="firstName" name="firstName" required />
                    </div>
                    <div>
                        <label for="lastName">Full Name (Last) <span class="required">*</span></label>
                        <input id="lastName" name="lastName" required />
                    </div>
                </div>
                <div class="grid-3">
                    <div>
                        <label for="dateOfBirth">Date of Birth <span class="required">*</span></label>
                        <input type="date" id="dateOfBirth" name="dateOfBirth" required />
                    </div>
                    <div>
                        <label for="gender">Gender</label>
                        <select id="gender" name="gender">
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label for="phone">Phone Number <span class="required">*</span></label>
                        <input type="tel" id="phone" name="phone" required />
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label for="email">Email Address (Gmail Required) <span class="required">*</span></label>
                        <input type="email" id="email" name="email" required />
                        <div class="helper">We'll send your assessment results to this Gmail address</div>
                    </div>
                    <div>
                        <label for="password">Create Password <span class="required">*</span></label>
                        <input id="password" name="password" type="password" minlength="8" placeholder="Choose a secure password" required />
                        <div class="helper">Minimum 8 characters.</div>
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label for="confirmPassword">Confirm Password <span class="required">*</span></label>
                        <input id="confirmPassword" name="confirmPassword" type="password" minlength="8" placeholder="Confirm password" required />
                    </div>
                    <div>
                        <label for="address">Home Address <span class="required">*</span></label>
                        <input id="address" name="address" required />
                    </div>
                </div>
                <div class="grid-3">
                    <div>
                        <label for="city">City <span class="required">*</span></label>
                        <input id="city" name="city" required />
                    </div>
                    <div>
                        <label for="state">State <span class="required">*</span></label>
                        <input id="state" name="state" required />
                    </div>
                    <div>
                        <label for="zipCode">ZIP Code <span class="required">*</span></label>
                        <input id="zipCode" name="zipCode" required />
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label for="emergencyContactName">Emergency Contact Name <span class="required">*</span></label>
                        <input id="emergencyContactName" name="emergencyContactName" required />
                    </div>
                    <div>
                        <label for="emergencyContactPhone">Emergency Contact Phone <span class="required">*</span></label>
                        <input type="tel" id="emergencyContactPhone" name="emergencyContactPhone" required />
                    </div>
                </div>
            </fieldset>

            <!-- Employment Information -->
            <fieldset>
                <legend>2. Employment Information</legend>
                <div>
                    <label>Position Applying For <span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" id="companyDriver" name="positionType" value="company-driver" required />
                            <label for="companyDriver">Company Driver</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="teamDriver" name="positionType" value="team-driver" />
                            <label for="teamDriver">Team Driver</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="localDriver" name="positionType" value="local" />
                            <label for="localDriver">Local</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="otrDriver" name="positionType" value="otr" />
                            <label for="otrDriver">OTR</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="regionalDriver" name="positionType" value="regional" />
                            <label for="regionalDriver">Regional</label>
                        </div>
                    </div>
                </div>
                <div class="grid-3">
                    <div>
                        <label for="availabilityStartDate">Availability Start Date <span class="required">*</span></label>
                        <input type="date" id="availabilityStartDate" name="availabilityStartDate" required />
                    </div>
                    <div>
                        <label for="preferredRoutes">Preferred Route Type <span class="required">*</span></label>
                        <select id="preferredRoutes" name="preferredRoutes" required>
                            <option value="">Select Route Type</option>
                            <option value="local">Local</option>
                            <option value="regional">Regional</option>
                            <option value="otr">OTR (Over The Road)</option>
                        </select>
                    </div>
                    <div>
                        <label for="yearsExperience">Years of Driving Experience <span class="required">*</span></label>
                        <select id="yearsExperience" name="yearsExperience" required>
                            <option value="">Select Experience</option>
                            <option value="0-1">0-1 years</option>
                            <option value="1-3">1-3 years</option>
                            <option value="3-5">3-5 years</option>
                            <option value="5-10">5-10 years</option>
                            <option value="10+">10+ years</option>
                        </select>
                    </div>
                </div>
            </fieldset>

            <!-- Driver License Information -->
            <fieldset>
                <legend>3. Driver License Information</legend>
                <div class="grid-3">
                    <div>
                        <label for="licenseNumber">Driver License Number <span class="required">*</span></label>
                        <input id="licenseNumber" name="licenseNumber" required />
                    </div>
                    <div>
                        <label for="licenseState">State Issued <span class="required">*</span></label>
                        <input id="licenseState" name="licenseState" required />
                    </div>
                    <div>
                        <label for="licenseExpiry">License Expiration Date <span class="required">*</span></label>
                        <input type="date" id="licenseExpiry" name="licenseExpiry" required />
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label>License Class <span class="required">*</span></label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="radio" id="classA" name="licenseClass" value="A" required />
                                <label for="classA">Class A</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="classB" name="licenseClass" value="B" />
                                <label for="classB">Class B</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="classC" name="licenseClass" value="C" />
                                <label for="classC">Class C</label>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label>Endorsements</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="hazmat" name="endorsements" value="hazmat" />
                                <label for="hazmat">Hazmat</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="tanker" name="endorsements" value="tanker" />
                                <label for="tanker">Tanker</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doubles" name="endorsements" value="doubles" />
                                <label for="doubles">Double/Triple</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="noEndorsements" name="endorsements" value="none" />
                                <label for="noEndorsements">None</label>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>

            <!-- Driving History -->
            <fieldset>
                <legend>4. Driving History (Past 3 Years)</legend>
                <div class="grid-2">
                    <div>
                        <label for="previousEmployer1">Previous Employer 1</label>
                        <input id="previousEmployer1" name="previousEmployer1" />
                    </div>
                    <div>
                        <label for="employmentDates1">Employment Dates 1</label>
                        <input id="employmentDates1" name="employmentDates1" placeholder="MM/YYYY - MM/YYYY" />
                    </div>
                </div>
                <div>
                    <label for="reasonForLeaving1">Reason for Leaving 1</label>
                    <textarea id="reasonForLeaving1" name="reasonForLeaving1"></textarea>
                </div>
                <div class="grid-2">
                    <div>
                        <label for="previousEmployer2">Previous Employer 2</label>
                        <input id="previousEmployer2" name="previousEmployer2" />
                    </div>
                    <div>
                        <label for="employmentDates2">Employment Dates 2</label>
                        <input id="employmentDates2" name="employmentDates2" placeholder="MM/YYYY - MM/YYYY" />
                    </div>
                </div>
                <div>
                    <label for="reasonForLeaving2">Reason for Leaving 2</label>
                    <textarea id="reasonForLeaving2" name="reasonForLeaving2"></textarea>
                </div>
            </fieldset>

            <!-- Safety & Compliance -->
            <fieldset>
                <legend>5. Safety & Compliance</legend>
                <div>
                    <label>Any accidents in the last 3 years? <span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" id="accidentsYes" name="hasAccidents" value="yes" required />
                            <label for="accidentsYes">Yes</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="accidentsNo" name="hasAccidents" value="no" />
                            <label for="accidentsNo">No</label>
                        </div>
                    </div>
                </div>
                <div>
                    <label for="accidentDetails">If yes, explain accidents:</label>
                    <textarea id="accidentDetails" name="accidentDetails"></textarea>
                </div>
                <div>
                    <label>Any traffic violations in the last 3 years? <span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" id="violationsYes" name="hasViolations" value="yes" required />
                            <label for="violationsYes">Yes</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="violationsNo" name="hasViolations" value="no" />
                            <label for="violationsNo">No</label>
                        </div>
                    </div>
                </div>
                <div>
                    <label for="violationDetails">If yes, explain violations:</label>
                    <textarea id="violationDetails" name="violationDetails"></textarea>
                </div>
                <div>
                    <label>Have you ever failed or refused a DOT drug/alcohol test? <span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" id="dotTestYes" name="failedDotTest" value="yes" required />
                            <label for="dotTestYes">Yes</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="dotTestNo" name="failedDotTest" value="no" />
                            <label for="dotTestNo">No</label>
                        </div>
                    </div>
                </div>
            </fieldset>

            <!-- Medical & DOT Compliance -->
            <fieldset>
                <legend>6. Medical & DOT Compliance</legend>
                <div class="grid-2">
                    <div>
                        <label>Do you have a valid DOT Medical Card? <span class="required">*</span></label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="radio" id="medicalCardYes" name="hasMedicalCard" value="yes" required />
                                <label for="medicalCardYes">Yes</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="medicalCardNo" name="hasMedicalCard" value="no" />
                                <label for="medicalCardNo">No</label>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="medicalCardExpiry">Medical Card Expiration Date</label>
                        <input type="date" id="medicalCardExpiry" name="medicalCardExpiry" />
                    </div>
                </div>
            </fieldset>

            <!-- Authorization & Declaration -->
            <fieldset>
                <legend>7. Authorization & Declaration</legend>
                <div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="authorization" name="authorization" value="yes" required />
                        <label for="authorization">
                            I certify that the information provided is true and complete. I authorize the company to verify this information and conduct background, driving record, and drug/alcohol checks as required by law. <span class="required">*</span>
                        </label>
                    </div>
                </div>
            </fieldset>

            <div class="actions">
                <button type="submit" class="btn-primary">Submit Application</button>
                <button type="reset" class="btn-secondary">Clear Form</button>
            </div>

            <div class="success" id="successMessage">
                <strong>âœ… Application Submitted Successfully!</strong><br>
                Thank you for your application. Our assessment team will review your information and contact you via email within 24-72 hours with next steps.
            </div>
            <div class="error" id="errorMessage"></div>
        </form>
    </main>

    <script>
        document.getElementById('applicantForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {};
            
            // Handle regular form fields
            for (let [key, value] of formData.entries()) {
                if (key === 'endorsements') {
                    if (!data[key]) data[key] = [];
                    data[key].push(value);
                } else {
                    data[key] = value;
                }
            }
            
            // Convert endorsements array to string
            if (data.endorsements) {
                data.endorsements = data.endorsements.join(', ');
            }

            // Validate password match if provided
            const password = data.password || '';
            const confirmPassword = formData.get('confirmPassword') || '';
            if (!password || password.length < 8) {
                document.getElementById('errorMessage').textContent = 'Error: Password is required and must be at least 8 characters.';
                document.getElementById('errorMessage').style.display = 'block';
                return;
            }
            if (password !== confirmPassword) {
                document.getElementById('errorMessage').textContent = 'Error: Passwords do not match.';
                document.getElementById('errorMessage').style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/applicant', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                // Log response details for debugging
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                // Check if response is actually JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const textResponse = await response.text();
                    console.error('Non-JSON response received:', textResponse);
                    throw new Error('Server returned non-JSON response. Please try again or contact support.');
                }

                const result = await response.json();
                
                if (result.ok) {
                    // If backend created a user account, redirect to login
                    if (result.user_created) {
                        window.location.href = 'login.html';
                        return;
                    }
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('errorMessage').style.display = 'none';
                    this.reset();
                    window.scrollTo(0, 0);
                } else {
                    throw new Error(result.error || 'Submission failed');
                }
            } catch (error) {
                console.error('Submission error:', error);
                document.getElementById('errorMessage').textContent = 'Error: ' + error.message;
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('successMessage').style.display = 'none';
            }
        });

        // Email validation to require Gmail
        document.getElementById('email').addEventListener('blur', function() {
            const email = this.value.toLowerCase();
            const errorDiv = this.parentNode.querySelector('.gmail-error');
            
            if (email && !email.endsWith('@gmail.com')) {
                this.style.borderColor = '#dc2626';
                this.setCustomValidity('Please use a Gmail address (e.g., name@gmail.com)');
                
                if (!errorDiv) {
                    const msg = document.createElement('div');
                    msg.className = 'helper gmail-error';
                    msg.style.color = '#dc2626';
                    msg.textContent = 'A Gmail address is required for assessment results.';
                    this.parentNode.appendChild(msg);
                }
            } else {
                this.style.borderColor = '#d1d5db';
                this.setCustomValidity('');
                if (errorDiv) errorDiv.remove();
            }
        });
    </script>
</body>
</html>

